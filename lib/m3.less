// Temporary helper function, replace later
#__m3-rgb(@id, @color) {
  --@{id}: @color;
  --@{id}-rgb: #rgbify(@color) [];
}

// TODO: Run fmt pass

#__m3_color_system() {
  .base() {
    @m3-primary: @accent;
    @m3-secondary: desaturate(@accent, 15%);
    @m3-tertiary: lighten(@accent, 5%);
    @m3-emphasize: 10%;
    @m3-deemphasize: 10%;
    @m3-tint: fade(30%);

    @m3-inverse-flavor: if(@flavor = latte, mocha, latte);
    @m3-black: #000;
  }

  .gm3-sys-color() {
    .gen-colors('--gm3-sys-color-');
  }

  .md-sys-color() {
    .gen-colors('--md-sys-color-');
  }

  .gm3-color() {
    .gen-colors('--gm3-color-');
  }

  .gem-sys-color() {
    .gen-colors('--gem-sys-color-');
  }

  .mat-sys() {
    .gen-colors('--mat-sys-');
  }

  .dt() {
    .gen-colors('--dt-');
  }

  .pkw() {
    .gen-colors('--pkw-');
  }

  .tasks() {
    .gen-colors('--tasks-');
  }

  .gen-colors(@prefix) {
    #__m3-rgb(@{prefix}background, @base);
    #__m3-rgb(@{prefix}error, @red);
    #__m3-rgb(@{prefix}error-container, fade(@red, @m3-tint));
    #__m3-rgb(@{prefix}inverse-on-surface, @base);
    // m3-primary
    #__m3-rgb(@{prefix}inverse-primary, @catppuccin[@@m3-inverse-flavor][@accent]);
    #__m3-rgb(@{prefix}inverse-surface, @text);
    #__m3-rgb(@{prefix}on-background, @text);
    #__m3-rgb(@{prefix}on-error, @base);
    #__m3-rgb(@{prefix}on-error-container, lighten(@red, @m3-emphasize));
    #__m3-rgb(@{prefix}on-primary, @base);
    #__m3-rgb(@{prefix}on-primary-container, lighten(@m3-primary, @m3-emphasize));
    #__m3-rgb(@{prefix}on-primary-fixed, @catppuccin[@mocha][@base]);
    #__m3-rgb(@{prefix}on-primary-fixed-variant, @catppuccin[@mocha][@base]);
    #__m3-rgb(@{prefix}on-secondary, @base);
    #__m3-rgb(@{prefix}on-secondary-container, lighten(@m3-secondary, @m3-emphasize));
    #__m3-rgb(@{prefix}on-secondary-fixed, @catppuccin[@mocha][@base]);
    #__m3-rgb(@{prefix}on-secondary-fixed-variant, @catppuccin[@mocha][@base]);
    #__m3-rgb(@{prefix}on-surface, @text);
    #__m3-rgb(@{prefix}on-surface-variant, @subtext0);
    #__m3-rgb(@{prefix}on-tertiary, @base);
    #__m3-rgb(@{prefix}on-tertiary-container, lighten(@m3-tertiary, @m3-emphasize));
    #__m3-rgb(@{prefix}on-tertiary-fixed, @catppuccin[@mocha][@base]);
    #__m3-rgb(@{prefix}on-tertiary-fixed-variant, @catppuccin[@mocha][@base]);
    #__m3-rgb(@{prefix}outline, @overlay2);
    #__m3-rgb(@{prefix}outline-variant, @overlay0);
    #__m3-rgb(@{prefix}primary, @m3-primary);
    #__m3-rgb(@{prefix}primary-container, fade(@m3-primary, @m3-tint));
    // m3-primary
    #__m3-rgb(@{prefix}primary-fixed, @catppuccin[@mocha][@accent]);
    // m3-primary
    #__m3-rgb(@{prefix}primary-fixed-dim, darken(@catppuccin[@mocha][@accent], @m3-deemphasize));
    #__m3-rgb(@{prefix}scrim, @m3-black);
    #__m3-rgb(@{prefix}secondary, @m3-secondary);
    #__m3-rgb(@{prefix}secondary-container, fade(@m3-secondary, @m3-tint));
    // m3-secondary
    #__m3-rgb(@{prefix}secondary-fixed, desaturate(@catppuccin[@mocha][@accent], 15%));
    // m3-secondary
    #__m3-rgb(@{prefix}secondary-fixed-dim, darken(desaturate(@catppuccin[@mocha][@accent], 15%), @m3-deemphasize));
    #__m3-rgb(@{prefix}shadow, @m3-black);
    #__m3-rgb(@{prefix}surface, @base);
    #__m3-rgb(@{prefix}surface-bright, @surface0);
    #__m3-rgb(@{prefix}surface-container, @surface0);
    #__m3-rgb(@{prefix}surface-container-high, @surface1);
    #__m3-rgb(@{prefix}surface-container-highest, @surface2);
    #__m3-rgb(@{prefix}surface-container-low, @mantle);
    #__m3-rgb(@{prefix}surface-container-lowest, @crust);
    #__m3-rgb(@{prefix}surface-dim, @mantle);
    #__m3-rgb(@{prefix}surface-tint, @accent);
    #__m3-rgb(@{prefix}surface-variant, @overlay1);
    #__m3-rgb(@{prefix}tertiary, @m3-tertiary);
    #__m3-rgb(@{prefix}tertiary-container, fade(@m3-tertiary, @m3-tint));
    // m3-tertiary
    #__m3-rgb(@{prefix}tertiary-fixed, lighten(@catppuccin[@mocha][@accent], 5%));
    // m3-tertiary
    #__m3-rgb(@{prefix}tertiary-fixed-dim, darken(lighten(@catppuccin[@mocha][@accent], 5%), @m3-deemphasize));
  }
}