---
import { ports, type PortEntry } from "../../lib/ports";
import StarlightPage from "@astrojs/starlight/components/StarlightPage.astro";
import { Markdown } from 'astro-remote';
import { Card } from "@astrojs/starlight/components";

export async function getStaticPaths() {
  return ports.map((port) => ({
    params: { slug: port.slug },
    props: { port },
  }));
}

const { port } = Astro.props as { port: PortEntry };

// Collect all maintainers in one list
const allMaintainers = [
  ...(port.currentMaintainers ?? []),
  ...(port.pastMaintainers ?? []),
  ...(port.supports ? Object.keys(port.supports) : []),
];
---

<StarlightPage frontmatter={{ title: port.name }}>
  <section class="prose">
    <Card title="Overview">
      <p>
        <strong>Link:</strong>{" "}
        <a href={port.link} target="_blank" rel="noopener">
          {port.link}
        </a>
      </p>
      {port.icon && <p><strong>Icon:</strong> {port.icon}</p>}
      <p><strong>Categories:</strong> {port.categories.join(", ")}</p>
      <p><strong>Color:</strong> {port.color}</p>
    </Card>

    {port.note && (
      <Card title="Notes">
        <Markdown content={port.note} />
      </Card>
    )}

    {allMaintainers.length > 0 && (
      <Card title="Maintainers">
        <p>{allMaintainers.join(", ")}</p>
      </Card>
    )}

    {port.supports && (
      <Card title="Supports">
        <ul>
          {Object.values(port.supports).map((s) => (
            <li>
              <a href={s.link} target="_blank" rel="noopener">{s.name}</a>
            </li>
          ))}
        </ul>
      </Card>
    )}
  </section>
</StarlightPage>
